<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idle Garden Tycoon</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        :root {
            --bg-color: #5d9250; --container-bg: #a1ff9b; --border-color: #5a3a22;
            --soil-color: #8B4513; --tile-color: #A0522D; --ui-bg: #f0e68c;
            --ui-border: #d2b48c; --text-color: #333;
        }
        body { font-family: 'Press Start 2P', cursive; background-color: var(--bg-color); color: var(--text-color); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; user-select: none; }
        #login-screen { display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); justify-content: center; align-items: center; z-index: 100; flex-direction: column; gap: 20px; }
        .login-box { background: var(--ui-bg); padding: 40px; border: 5px solid var(--border-color); border-radius: 15px; text-align: center; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .login-box h1 { font-size: 1.5em; margin-bottom: 20px; }
        .login-box input { font-family: 'Press Start 2P', cursive; padding: 10px; font-size: 1em; border: 3px solid var(--border-color); border-radius: 5px; text-align: center; }
        .login-box button { font-family: 'Press Start 2P', cursive; padding: 12px 20px; font-size: 1em; margin-top: 15px; cursor: pointer; border-radius: 8px; border: 3px solid #333; background-color: #90ee90; box-shadow: 0 4px #558b55; transition: all 0.1s ease; }
        .login-box button:active { transform: translateY(4px); box-shadow: none; }
        #game-container { display: none; width: 95%; max-width: 1200px; background: var(--container-bg); border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); border: 5px solid var(--border-color); padding: 20px; flex-direction: column; gap: 15px; }
        #resource-bar { display: flex; justify-content: space-between; align-items: center; background: var(--ui-bg); padding: 15px; border-radius: 10px; border: 3px solid var(--ui-border); font-size: 1.1em; }
        #player-controls { display: flex; align-items: center; gap: 15px; }
        #change-player-btn { font-size: 0.6em; padding: 5px 8px; cursor: pointer; background: #ff7f7f; border: 2px solid #c86464; border-radius: 5px; }
        #main-area { display: flex; gap: 20px; }
        #garden-plot { flex-grow: 1; display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; background-color: var(--soil-color); padding: 10px; border-radius: 10px; border: 3px solid var(--border-color); }
        .tile { width: 100%; padding-bottom: 100%; position: relative; background-color: var(--tile-color); border-radius: 8px; cursor: pointer; transition: transform 0.1s ease, background-color 0.2s; box-shadow: inset 0 0 5px rgba(0,0,0,0.4); overflow: hidden; }
        .tile:hover { transform: scale(1.05); }
        .tile-content { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; font-size: 2.5em; pointer-events: none; animation: pop-in 0.3s ease; }
        @keyframes pop-in { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        .progress-bar { position: absolute; bottom: 5px; left: 5%; width: 90%; height: 8px; background-color: rgba(0,0,0,0.5); border-radius: 4px; border: 1px solid #333; }
        .progress-bar-inner { height: 100%; background-color: #4caf50; border-radius: 4px; width: 0%; transition: width 0.5s linear; }
        .tile-content.ready { animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10%); } }
        #controls { width: 350px; display: flex; flex-direction: column; gap: 15px; max-height: 75vh; overflow-y: auto; }
        .ui-panel { background: #f5deb3; padding: 15px; border-radius: 10px; border: 3px solid var(--ui-border); display: flex; flex-direction: column; gap: 10px; }
        .ui-panel h2 { margin: 0 0 5px 0; text-align: center; font-size: 1.2em; }
        #shop-timer { font-size: 0.7em; text-align: center; margin-bottom: 10px; }
        .shop-item, .inventory-item { display: flex; align-items: center; padding: 10px; border: 2px solid var(--border-color); border-radius: 8px; background-color: #fff8dc; transition: background-color 0.2s, transform 0.1s; cursor: pointer; }
        .shop-item:hover, .inventory-item:hover { background-color: #fafad2; }
        .inventory-item.selected { background-color: #98FB98; transform: scale(1.02); }
        .shop-item.disabled { opacity: 0.5; cursor: not-allowed; background-color: #ccc; }
        .plant-icon { font-size: 2em; margin-right: 10px; }
        .plant-info { font-size: 0.6em; line-height: 1.4; flex-grow: 1;}
        .sell-one-btn { font-family: 'Press Start 2P', cursive; background: #ffc107; border: 2px solid #e0a800; border-radius: 5px; padding: 5px 8px; font-size: 0.8em; cursor: pointer; margin-left: 10px; }
        .sell-one-btn:hover { background: #ffca2c; }
        #sell-all-btn { font-family: 'Press Start 2P', cursive; padding: 12px; font-size: 0.9em; margin-top: 10px; cursor: pointer; border-radius: 8px; border: 3px solid #333; background-color: #ffd700; box-shadow: 0 4px #b39700; transition: all 0.1s ease; }
        #sell-all-btn:disabled { background: #ccc; box-shadow: 0 4px #888; cursor: not-allowed; }
        #sell-all-btn:active:not(:disabled) { transform: translateY(4px); box-shadow: none; }
        .inventory-header { font-size: 0.8em; text-align: center; margin-top: 10px; margin-bottom: -5px; border-bottom: 2px solid var(--ui-border); padding-bottom: 5px; }
        #notification { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background-color: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 10px; font-size: 0.9em; opacity: 0; transition: all 0.5s; pointer-events: none; z-index: 200; }
    </style>
</head>
<body>
    <div id="login-screen">
        <div class="login-box">
            <h1>Idle Garden Tycoon</h1>
            <p style="font-size:0.8em; margin-bottom: 20px;">Bahçıvan adını gir.</p>
            <input type="text" id="player-name-input" placeholder="Bahçıvan Adı">
            <button id="start-game-btn">Oyuna Başla</button>
        </div>
    </div>
    <div id="game-container">
        <div id="resource-bar">
            <div id="player-controls">
                <div id="player-info">Oyuncu: <span id="player-name-display"></span></div>
                <button id="change-player-btn">Değiştir</button>
            </div>
            <div class="resource">💰 <span id="money-count">0</span></div>
        </div>
        <div id="main-area">
            <div id="garden-plot"></div>
            <div id="controls">
                <div id="shop" class="ui-panel">
                    <h2>Dükkan (Tohum Al)</h2>
                    <div id="shop-timer"></div>
                    <div id="shop-items"></div>
                </div>
                <div id="inventory" class="ui-panel">
                    <h2>Envanter</h2>
                    <div id="inventory-items"></div>
                    <button id="sell-all-btn" disabled>Tümünü Sat</button>
                </div>
            </div>
        </div>
    </div>
    <div id="notification"></div>

    <script>
        const GRID_SIZE = 25, SHOP_RESTOCK_INTERVAL_MS = 5 * 60 * 1000, GAME_TICK_MS = 1000, SAVE_INTERVAL_MS = 5000;
        
        // --- YENİ FİYATLARLA GÜNCELLENMİŞ VERİTABANI ---
        const PLANT_DB = {
            havuc:       { name: 'Havuç', price: 20, growthTimeRange: [30, 30], emoji: '🥕' },
            apple:       { name: 'Elma', price: 250, growthTimeRange: [90, 2400], emoji: '🍎' },
            coconut:     { name: 'Hindistan Cevizi', price: 600, growthTimeRange: [300, 3300], emoji: '🥥' },
            cactus:      { name: 'Kaktüs', price: 1500, growthTimeRange: [600, 4200], emoji: '🌵' },
            dragonFruit: { name: 'Ejder Meyvesi', price: 5000, growthTimeRange: [900, 6000], emoji: '🐉' },
            mango:       { name: 'Mango', price: 10000, growthTimeRange: [1200, 7200], emoji: '🥭' },
            grape:       { name: 'Üzüm', price: 85000, growthTimeRange: [720, 5400], emoji: '🍇' },
            mushroom:    { name: 'Mantar', price: 150000, growthTimeRange: [600, 4800], emoji: '🍄' },
            pepper:      { name: 'Biber', price: 1000000, growthTimeRange: [1800, 7200], emoji: '🌶️' },
            cacao:       { name: 'Kakao', price: 2500000, growthTimeRange: [2400, 9000], emoji: '🫘' },
            beanstalk:   { name: 'Sırık Fasulye', price: 10000000, growthTimeRange: [3600, 10800], emoji: '🌿' },
            celestiberry:{ name: 'Gök Böğürtleni', price: 15000000, growthTimeRange: [3000, 10800], emoji: '✨' },
            elderStrawberry: { name: 'Kadim Çilek', price: 70000000, growthTimeRange: [4800, 13200], emoji: '🍓' },
        };
        Object.values(PLANT_DB).forEach(p => p.sellPrice = p.price * 2);

        const loginScreen = document.getElementById('login-screen'), gameContainer = document.getElementById('game-container'),
              playerNameInput = document.getElementById('player-name-input'), startGameBtn = document.getElementById('start-game-btn'),
              playerNameDisplay = document.getElementById('player-name-display'), moneyCountDisplay = document.getElementById('money-count'),
              gardenPlot = document.getElementById('garden-plot'), shopItemsContainer = document.getElementById('shop-items'),
              shopTimerDisplay = document.getElementById('shop-timer'), inventoryItemsContainer = document.getElementById('inventory-items'),
              sellAllBtn = document.getElementById('sell-all-btn'), notification = document.getElementById('notification'),
              changePlayerBtn = document.getElementById('change-player-btn');

        let gameState = {}, saveInterval, gameLoopInterval;

        const formatMoney = (amount) => '$' + amount.toLocaleString('en-US');
        const formatTime = (seconds) => `${Math.floor(seconds/60).toString().padStart(2,'0')}:${(seconds%60).toString().padStart(2,'0')}`;
        const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        function showNotification(message) { notification.textContent = message; notification.style.opacity = '1'; notification.style.top = '30px'; setTimeout(() => { notification.style.opacity = '0'; notification.style.top = '20px'; }, 2500); }
        function saveGame() { if (!gameState.playerName) return; gameState.lastSaveTime = Date.now(); localStorage.setItem(`idleGardenSave_${gameState.playerName}`, JSON.stringify(gameState)); }
        function loadGame(playerName) { const savedData = localStorage.getItem(`idleGardenSave_${playerName}`); return savedData ? JSON.parse(savedData) : null; }

        function startGame(playerName) {
            localStorage.setItem('idleGarden_lastPlayer', playerName);
            let loadedState = loadGame(playerName);
            if (loadedState) {
                gameState = loadedState;
                const secondsOffline = Math.floor((Date.now() - gameState.lastSaveTime) / 1000);
                if (secondsOffline > 1) {
                    gameState.garden.forEach(plant => { if (plant) plant.growth = Math.min(plant.totalGrowthTime, plant.growth + secondsOffline); });
                    showNotification(`${Math.floor(secondsOffline / 60)} dakika sonra geldin!`);
                }
            } else {
                gameState = { playerName, money: 20, garden: Array(GRID_SIZE).fill(null), seedInventory: {}, fruitInventory: {}, selectedPlant: null, shopItems: [], lastShopRestockTime: 0, lastSaveTime: Date.now() };
                showNotification(`Bahçene hoş geldin, ${playerName}!`);
            }
            gameState.seedInventory = gameState.seedInventory || {}; gameState.fruitInventory = gameState.fruitInventory || {}; gameState.shopItems = gameState.shopItems || [];

            loginScreen.style.display = 'none'; gameContainer.style.display = 'flex';
            playerNameDisplay.textContent = gameState.playerName;
            
            updateUI(); renderGarden(); renderInventory(); checkShopRestock(true);
            gameLoopInterval = setInterval(gameLoop, GAME_TICK_MS); saveInterval = setInterval(saveGame, SAVE_INTERVAL_MS);
        }
        
        function checkShopRestock(force = false) {
            const now = Date.now(), currentBlock = Math.floor(now / SHOP_RESTOCK_INTERVAL_MS);
            const lastBlock = gameState.lastShopRestockTime ? Math.floor(gameState.lastShopRestockTime / SHOP_RESTOCK_INTERVAL_MS) : 0;

            if (force || currentBlock > lastBlock) {
                gameState.lastShopRestockTime = now;
                const newShop = [];
                newShop.push({ id: 'havuc', stock: randomInt(10, 30) });

                const rareSeeds = Object.keys(PLANT_DB).filter(id => id !== 'havuc');
                for (let i = rareSeeds.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [rareSeeds[i], rareSeeds[j]] = [rareSeeds[j], rareSeeds[i]]; }
                
                const numRareItems = randomInt(2, 4);
                for(let i=0; i<numRareItems && i < rareSeeds.length; i++) {
                    newShop.push({ id: rareSeeds[i], stock: randomInt(5, 20) });
                }
                gameState.shopItems = newShop.sort((a,b) => PLANT_DB[a.id].price - PLANT_DB[b.id].price);
                
                renderShop(); if (!force) showNotification("Dükkan yenilendi!");
            }
        }
        function updateUI() {
            moneyCountDisplay.textContent = formatMoney(gameState.money);
            const timeUntilNextBlock = SHOP_RESTOCK_INTERVAL_MS - (Date.now() % SHOP_RESTOCK_INTERVAL_MS);
            shopTimerDisplay.textContent = `Yenilenme: ${formatTime(Math.ceil(timeUntilNextBlock / 1000))}`;
        }
        function renderShop() {
            shopItemsContainer.innerHTML = '';
            gameState.shopItems.forEach(item => {
                const plant = PLANT_DB[item.id];
                const isDisabled = plant.price > gameState.money || item.stock <= 0;
                const shopItemEl = document.createElement('div');
                shopItemEl.className = `shop-item ${isDisabled ? 'disabled' : ''}`;
                shopItemEl.innerHTML = `<div class="plant-icon">🌱</div><div class="plant-info"><strong>${plant.name} Tohumu</strong><div>Fiyat: ${formatMoney(plant.price)}</div><div>Stok: ${item.stock > 0 ? item.stock : 'Tükendi'}</div></div>`;
                if (!isDisabled) { shopItemEl.addEventListener('click', () => onShopItemClick(item.id)); }
                shopItemsContainer.appendChild(shopItemEl);
            });
        }
        function onShopItemClick(plantId) {
            const shopItem = gameState.shopItems.find(item => item.id === plantId);
            if (!shopItem || shopItem.stock <= 0) return;
            const plant = PLANT_DB[plantId];
            if (gameState.money >= plant.price) {
                gameState.money -= plant.price; shopItem.stock--;
                gameState.seedInventory[plantId] = (gameState.seedInventory[plantId] || 0) + 1;
                showNotification(`${plant.name} tohumu alındı!`);
                renderShop(); renderInventory();
            } else { showNotification("Yeterli paran yok!"); }
        }
        window.onload = () => { const lastPlayer = localStorage.getItem('idleGarden_lastPlayer'); if (lastPlayer) startGame(lastPlayer); else loginScreen.style.display = 'flex'; };
        startGameBtn.addEventListener('click', () => { const playerName = playerNameInput.value.trim(); if (playerName && playerName.length < 20) startGame(playerName); else alert("Lütfen geçerli ve kısa bir isim gir!"); });
        changePlayerBtn.addEventListener('click', () => { if (confirm('Oyuncu değiştirmek istediğine emin misin?')) { localStorage.removeItem('idleGarden_lastPlayer'); window.location.reload(); } });
        function onInventoryItemClick(plantId) { gameState.selectedPlant = (gameState.selectedPlant === plantId) ? null : plantId; renderInventory(); }
        function onSellOneClick(plantId) { gameState.money += PLANT_DB[plantId].sellPrice; gameState.fruitInventory[plantId]--; if (gameState.fruitInventory[plantId] <= 0) delete gameState.fruitInventory[plantId]; showNotification(`1 ${PLANT_DB[plantId].name} satıldı.`); renderShop(); renderInventory(); }
        function sellAllInventory() { let totalSellValue = 0; for (const plantId in gameState.fruitInventory) { totalSellValue += gameState.fruitInventory[plantId] * PLANT_DB[plantId].sellPrice; } if (totalSellValue > 0) { gameState.money += totalSellValue; gameState.fruitInventory = {}; showNotification(`Toplam ${formatMoney(totalSellValue)} kazandın!`); renderShop(); renderInventory(); } }
        function renderInventory() { inventoryItemsContainer.innerHTML = ''; const seedKeys = Object.keys(gameState.seedInventory).sort((a, b) => PLANT_DB[a].price - PLANT_DB[b].price); const fruitKeys = Object.keys(gameState.fruitInventory).sort((a, b) => PLANT_DB[a].price - PLANT_DB[b].price); let hasContent = false; if(seedKeys.length > 0) { inventoryItemsContainer.innerHTML += `<div class="inventory-header">Tohumlar</div>`; seedKeys.forEach(plantId => { const quantity = gameState.seedInventory[plantId]; const plant = PLANT_DB[plantId]; if (quantity > 0) { hasContent = true; const item = document.createElement('div'); item.className = `inventory-item ${gameState.selectedPlant === plantId ? 'selected' : ''}`; item.innerHTML = `<div class="plant-icon">🌱</div><div class="plant-info"><strong>${plant.name} Tohumu</strong> <span>x${quantity}</span></div>`; item.addEventListener('click', () => onInventoryItemClick(plantId)); inventoryItemsContainer.appendChild(item); } }); } if(fruitKeys.length > 0) { inventoryItemsContainer.innerHTML += `<div class="inventory-header">Hasat Edilenler</div>`; fruitKeys.forEach(plantId => { const quantity = gameState.fruitInventory[plantId]; const plant = PLANT_DB[plantId]; if(quantity > 0) { hasContent = true; const item = document.createElement('div'); item.className = `inventory-item`; item.innerHTML = `<div class="plant-icon">${plant.emoji}</div><div class="plant-info"><strong>${plant.name}</strong> <span>x${quantity}</span></div><button class="sell-one-btn" data-plant-id="${plantId}">💰</button>`; item.querySelector('.sell-one-btn').addEventListener('click', (e) => { e.stopPropagation(); onSellOneClick(plantId); }); inventoryItemsContainer.appendChild(item); } }); } if (!hasContent) { inventoryItemsContainer.innerHTML = '<p style="font-size:0.7em;text-align:center;">Envanterin boş.</p>'; } sellAllBtn.disabled = fruitKeys.length === 0; }
        function onTileClick(index) { const tileState = gameState.garden[index]; if (tileState && tileState.growth >= tileState.totalGrowthTime) { const plantId = tileState.id; gameState.fruitInventory[plantId] = (gameState.fruitInventory[plantId] || 0) + 1; gameState.garden[index] = null; showNotification(`${PLANT_DB[plantId].name} hasat edildi!`); renderGarden(); renderInventory(); } else if (!tileState && gameState.selectedPlant) { if(gameState.seedInventory[gameState.selectedPlant] > 0) { const plantData = PLANT_DB[gameState.selectedPlant]; const [min, max] = plantData.growthTimeRange; gameState.garden[index] = { id: gameState.selectedPlant, growth: 0, totalGrowthTime: randomInt(min, max) }; gameState.seedInventory[gameState.selectedPlant]--; if (gameState.seedInventory[gameState.selectedPlant] <= 0) { delete gameState.seedInventory[gameState.selectedPlant]; gameState.selectedPlant = null; } renderGarden(); renderInventory(); } else { showNotification("Envanterinde bu tohumdan kalmadı!"); gameState.selectedPlant = null; renderInventory(); } } else if (tileState) { const remainingTime = tileState.totalGrowthTime - Math.floor(tileState.growth); showNotification(`Hasata kalan süre: ${formatTime(remainingTime)}`); } }
        function renderGarden() { gardenPlot.innerHTML = ''; for (let i = 0; i < GRID_SIZE; i++) { const tile = document.createElement('div'); tile.className = 'tile'; tile.dataset.index = i; const plant = gameState.garden[i]; if (plant) { const progress = Math.min(plant.growth / plant.totalGrowthTime, 1); tile.innerHTML = `<div class="tile-content ${progress >= 1 ? 'ready' : ''}">${PLANT_DB[plant.id].emoji}</div><div class="progress-bar"><div class="progress-bar-inner" style="width: ${progress * 100}%"></div></div>`; } tile.addEventListener('click', () => onTileClick(i)); gardenPlot.appendChild(tile); } }
        sellAllBtn.addEventListener('click', sellAllInventory);
        function gameLoop() { let gardenChanged = false; gameState.garden.forEach((plant) => { if (plant && plant.growth < plant.totalGrowthTime) { plant.growth++; gardenChanged = true; } }); if (gardenChanged) renderGarden(); checkShopRestock(); updateUI(); }
    </script>
</body>
</html>
